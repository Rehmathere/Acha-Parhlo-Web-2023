import React, { useEffect, useState } from 'react'
import { database1 } from './Portal/firebase'
import { addDoc, collection, deleteDoc, doc, getDocs, updateDoc } from 'firebase/firestore'

export default function Z_Test() {
  const [fname, setFname] = useState('')
  const [lname, setLname] = useState('')
  const [id, setId] = useState('')
  // Show & Values
  const [show, setShow] = useState(false)
  const [val, setVal] = useState([])
  // Making File Name In Firestore
  const value = collection(database1, "demo")
  // useEffect
  useEffect(() => {
    const getData = async () => {
      const dbVal = await getDocs(value)
      setVal(dbVal.docs.map(doc => ({ ...doc.data(), id: doc.id })))
    }
    getData()
  })
  // 1 Create Function
  const handleCreate = async () => {
    await addDoc(value, { name1: fname, name2: lname })
    setFname("")
    setLname("")
  }
  // 2 - Delete Function
  const handleDelete = async (id) => {
    const deleteVal = doc(database1, "demo", id)
    await deleteDoc(deleteVal)
  }
  // 3 - Edit ( Add ) Function
  const handleEdit = async (id, name1, name2) => {
    setFname(name1)
    setLname(name2)
    setId(id)
    setShow(true)
  }
  // 4 - Update Function
  const handleUpdate = async () => {
    const updateData = doc(database1, "demo", id)
    await updateDoc(updateData, { name1: fname, name2: lname })
    setShow(false)
    setFname("")
    setLname("")
  }
  // Main Body
  return (
    <>
      {/* Main Body Start */}
      <div className='container'>
        <input value={fname} onChange={(e) => setFname(e.target.value)} />
        <input value={lname} onChange={(e) => setLname(e.target.value)} />
        {!show ? <button onClick={handleCreate}>Create</button> :
          <button onClick={handleUpdate}>Update</button>}
        {
          val.map(values =>
            <div>
              <h1>{values.name1}</h1>
              <h1>{values.name2}</h1>
              <button onClick={() => handleDelete(values.id)}>Delete</button>
              <button onClick={() => handleEdit(values.id, values.name1, values.name2)}>Edit</button>
            </div>)
        }
      </div>
    </>
  );
};
